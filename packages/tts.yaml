alexa_media:
  accounts:
    - email: !secret alexa_email
      password: !secret alexa_password
      url: "amazon.com"
      include_devices:
        - "Family Room Echo"
        - "Living Room Echo"
        - "Master Bedroom Echo"


script:
  tts_home_climate:
    sequence:
      - service: notify.alexa_media
        data_template:
          data:
            type: tts
          target: media_player.family_room_echo
          message: "The temperature in the house is {{ state_attr('climate.home', 'current_temperature') }}."

  tts_windows_open:
    sequence:
      - service: notify.alexa_media
        data_template:
          data:
            type: tts
          target: media_player.master_bedroom_echo
          message: >
            {%- if states.group.security.state == "on" -%}
              The following are open:
              {%- for entity_id in states.group.security.attributes.entity_id -%}
                {% set parts = entity_id.split('.') %}
                {%- if states(entity_id) == 'on' -%}
                  ... {{ states[parts[0]][parts[1]].name }}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}